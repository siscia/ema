{"name":"Ema","tagline":"","body":"\r\n# ema\r\n\r\n![ema](https://raw.githubusercontent.com/siscia/ema/master/resources/logo/ema.jpeg)\r\n\r\n`Ema` provides a simple and easy abstraction to build REST service.\r\n\r\n`Ema` is a very little library built on top of [Liberator](http://clojure-liberator.github.io/liberator/).\r\n\r\nThe main idea is too provide a simple and yet powerful abstraction over Liberator itself.\r\n\r\n## Dependencies\r\n\r\n[![Clojars Project](http://clojars.org/ema/latest-version.svg)](http://clojars.org/ema)\r\n\r\n## Maturity\r\n\r\nThe project has just started thus it is not mature enough for any use.\r\n\r\n### Implemented\r\n\r\n* MongoDB layer\r\n* bidi (routing) layer\r\n* Authentication\r\n* GET search\r\n\r\n### To Be Implemented\r\n\r\n* Manage Middleware\r\n* SQL layer\r\n\r\n## Usage\r\n\r\nThe project is still unusable for any non-trivial project.\r\n\r\nHowever you can already have an idea of the way to use `Ema`\r\n\r\nCreate a new clojure project\r\n\r\n```clojure\r\nlein new awesome-name\r\n```\r\n\r\nMake the project.clj look like this.\r\n\r\n```clojure\r\n\r\n(defproject awesome-name \"0.1.0-SNAPSHOT\"\r\n  :description \"FIXME: write description\"\r\n  :url \"http://example.com/FIXME\"\r\n  :license {:name \"Eclipse Public License\"\r\n            :url \"http://www.eclipse.org/legal/epl-v10.html\"}\r\n  :dependencies [[org.clojure/clojure \"1.6.0\"]\r\n                 [ema \"0.0.x\"]         ;; added\r\n                 [http-kit \"2.1.19\"]]  ;; added\r\n  :main awesome-name.core)             ;; added\r\n\r\n```\r\nNote that I have added the dependecies.\r\n\r\nAt this point we need to generate our handler.\r\n\r\n```clojure\r\n(ns awesome-name.core\r\n  (:require [ema.core :refer [ema]]\r\n            [org.httpkit.server :refer [run-server]]))\r\n\r\n(def setting\r\n  {:key :mongo\r\n   :handler :bidi\r\n   :uri \"mongodb://localhost:27017\"\r\n   :database \"ema\"\r\n   :resources [{:key :mongo\r\n                :name \"user\"\r\n                :auth :first\r\n                :item-mth [:patch :delete :post] ;; no `put`\r\n                :collection-mth [:post]\r\n                :public-item-mth [:get]\r\n                :public-collection-mth [:get :post]}\r\n               {:key :mongo\r\n                :auth :first\r\n                :database \"test\" \r\n                :name \"session\"\r\n                :item-mth [:put] ;; no `get`, `patch` nor `delete`\r\n                :collection-mth [:post]\r\n                :public-collection-mth [:get]}]\r\n   :auth {:first {:key :mongo-dynamics\r\n                  :database \"ema\"\r\n                  :name \"user\"\r\n                  :username :username\r\n                  :password :password\r\n                  :security :dynamic}}})\r\n\r\n(def app\r\n  (ema setting))\r\n\r\n(defn -main []\r\n  (run-server app {:port 8000}))\r\n\r\n```\r\n\r\nNow you need to run an instance of MongoDB in your machine, or just change the `uri` key in something more appropriate, like the url of a cloud instance of MongoDB.\r\n\r\nNow run the following in your console\r\n\r\n``` bash\r\ncd\r\ncd /awesome-name\r\nlein run\r\n```\r\n\r\nand you should be ready to go.\r\n\r\nNow, if everything went smootly you are serving two REST resource, `user` and `session`.\r\n\r\nPlease note the configuration: you won't be able to `put` on `user` nor you will be able to `get`, `patch` and `delete` a single `session`.\r\n\r\nOf course you can change that.\r\n\r\nAlso, `user` and `session` are not in the same database (in the mongodb meaning).\r\n\r\n`user` is in the \"ema\" database while `session` is in the \"session\" database.\r\n\r\nIf you add other collections, let say `author` and `book`\r\n\r\n```clojure\r\n{\r\n :name \"authors\"\r\n :collection-entries [:post :get]\r\n :list-entries [:get :put :patch]\r\n}\r\n{\r\n :name \"book\"\r\n :database \"another-database\"\r\n :collection-entries [:post :get]\r\n :list-entries [:get :put :patch]\r\n} \r\n```\r\n\r\n`author` will be under the \"ema\" database while `book` will write in the \"another-database\".\r\n\r\n```bash\r\nsimo@simo:~/ema$ curl -X POST -d \"{\\\"siscia\\\" : \\\"pass\\\"}\" http://localhost:3000/user\r\n{\"siscia\":\"pass\",\"_id\":\"5423934fc8300b83ff02e5fe\"}\r\nsimo@simo:~/ema$ curl  http://localhost:3000/user\r\n{\"data\":[{\"_id\":\"5423934fc8300b83ff02e5fe\",\"siscia\":\"pass\"}]}\r\n```\r\n\r\n## Docker\r\n\r\nI also have packed ema itself as a Docker.\r\n\r\nYou still need a configuration file in .edn format (a clojure map).\r\n\r\nSuppose you have save the configuration file in `~/ema/config.edn` to run the docker you need to run the following.\r\n\r\n```bash\r\nsudo docker run --net=\"host\" -v ~/ema/:/ema siscia/ema:latest \"/ema/config.edn\" \r\n```\r\n\r\nAnd you should be running.\r\n\r\n## Keep it small\r\n\r\n`ema` has a lot of dependecies, most of them necessaries.\r\n\r\nIf you develop a web app it may be possible that your code has some common dependencies with `ema` itself.\r\n\r\nI am thinking about libraries like `http-kit` or `monger`.\r\n\r\nIf this is the case, right now, you could just exclude such dependencies from `ema`.\r\n\r\nTaking as example the previous `project.clj`, it could be written as:\r\n\r\n```clojure\r\n(defproject awesome-name \"0.1.0-SNAPSHOT\"\r\n  :description \"FIXME: write description\"\r\n  :url \"http://example.com/FIXME\"\r\n  :license {:name \"Eclipse Public License\"\r\n            :url \"http://www.eclipse.org/legal/epl-v10.html\"}\r\n  :dependencies [[org.clojure/clojure \"1.6.0\"]\r\n                 [ema \"0.0.8\" :exclusions [[http-kit]]] ;; added the exclusion\r\n                 [http-kit \"2.1.19\"]]  ;; you already have imported an http-kit\r\n  :main awesome-name.core)             \r\n\r\n```\r\n\r\nAs long as you keep your dependecies up to date this approach will work fine.\r\n\r\n## Issues\r\n\r\nFor any problem, if you don't find the doc clear or for really anything you can just open an issue here.\r\n\r\n## Contributing\r\n\r\nAs always contributing is very much welcome. Just send a Pull Request or Open an Issue.\r\n\r\n## License\r\n\r\nCopyright Â© 2014 Simone Mosciatti\r\n\r\nDistributed under the Eclipse Public License either version 1.0\r\n\r\n## Thanks\r\n\r\nThanks to Emanuela Furfaro for being my inspiration.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}